<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AR.js Marker Trigger HUD Video</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>

<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  renderer="antialias: false; precision: low;"
>

  <!-- MARKER USED ONLY AS TRIGGER -->
  <a-marker
    id="triggerMarker"
    type="pattern"
    url="pattern-qr.patt"
    emitevents="true"
  ></a-marker>

  <!-- Camera -->
  <a-entity camera>

    <!-- CAMERA-SPACE VIDEO (HUD) -->
    <a-video
      id="videoHUD"
      src="#vid"
      width="3.2"   <!-- 2x bigger -->
      height="1.8"
      position="0 0 -2"
      visible="false"
      muted
      playsinline
      webkit-playsinline
    ></a-video>

  </a-entity>

</a-scene>

<!-- Video asset (NO autoplay = no flash) -->
<video
  id="vid"
  src="video.mp4"
  loop
  muted
  playsinline
  webkit-playsinline
></video>

<script>
window.addEventListener("DOMContentLoaded", () => {

  const marker = document.querySelector("#triggerMarker");
  const videoEntity = document.querySelector("#videoHUD");
  const videoEl = document.querySelector("#vid");
  const scene = document.querySelector("a-scene");

  let activated = false;

  marker.addEventListener("markerFound", async () => {
    if (activated) return;
    activated = true;

    // Start video ONLY after marker is detected
    try {
      await videoEl.play();
    } catch (e) {
      console.warn("Video play blocked until user interaction");
    }

    videoEntity.setAttribute("visible", true);

    // Disable marker tracking for performance
    scene.setAttribute("arjs", "trackingMethod: none;");

    // Remove marker completely
    marker.parentNode.removeChild(marker);
  });

});
</script>

</body>
</html>