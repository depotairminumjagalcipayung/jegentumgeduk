<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AR.js Marker Trigger HUD Video (No Flash)</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
  </style>

  <script>
    AFRAME.registerComponent("scale-by-z", {
      schema: {
        baseWidth:  { default: 1.6 },
        baseHeight: { default: 0.9 },
        minZ:       { default: -3.0 },
        maxZ:       { default: -1.2 }
      },

      tick() {
        const z = this.el.object3D.position.z;

        const t = THREE.MathUtils.clamp(
          (z - this.data.minZ) / (this.data.maxZ - this.data.minZ),
          0, 1
        );

        const scale = THREE.MathUtils.lerp(0.6, 1.4, t);

        this.el.setAttribute("width",  this.data.baseWidth  * scale);
        this.el.setAttribute("height", this.data.baseHeight * scale);
      }
    });
  </script>
</head>

<body>

<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  renderer="antialias: false; precision: low;"
>

  <!-- Marker ONLY as trigger -->
  <a-marker
    id="triggerMarker"
    type="pattern"
    url="pattern-qr.patt"
    emitevents="true"
  ></a-marker>

  <!-- Camera -->
  <a-entity camera>

    <!-- HUD Video -->
    <a-video
      id="videoHUD"
      src="#vid"
      width="1.6"
      height="0.9"
      position="0 0 -2"
      visible="false"
      scale-by-z
      muted
      playsinline
      webkit-playsinline
    ></a-video>

  </a-entity>

</a-scene>

<!-- IMPORTANT: no autoplay here -->
<video
  id="vid"
  src="video.mp4"
  loop
  muted
  playsinline
  webkit-playsinline
></video>

<script>
window.addEventListener("DOMContentLoaded", () => {

  const marker = document.querySelector("#triggerMarker");
  const videoEntity = document.querySelector("#videoHUD");
  const videoEl = document.querySelector("#vid");
  const scene = document.querySelector("a-scene");

  let activated = false;

  marker.addEventListener("markerFound", async () => {
    if (activated) return;
    activated = true;

    // Start video ONLY after trigger (prevents flash)
    try {
      await videoEl.play();
    } catch (e) {
      console.warn("Video play blocked until user interaction");
    }

    videoEntity.setAttribute("visible", true);

    // Disable tracking & remove marker
    scene.setAttribute("arjs", "trackingMethod: none;");
    marker.parentNode.removeChild(marker);
  });

});
</script>

</body>
</html>